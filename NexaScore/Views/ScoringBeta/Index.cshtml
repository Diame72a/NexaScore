@{
    ViewData["Title"] = "IA Matching Beta";
}

<div class="container py-5 text-center position-relative">

    <div class="mb-5 animate-fade-in">
        <div class="d-inline-flex align-items-center justify-content-center bg-warning bg-opacity-10 text-warning rounded-circle mb-3 shadow-sm" style="width: 80px; height: 80px;">
            <i class="fas fa-robot fa-3x"></i>
        </div>
        <h1 class="fw-bold text-dark">IA Matching <span class="badge bg-warning text-dark fs-6 align-middle ms-2">BETA</span></h1>
        <p class="text-muted lead">Uploadez un CV et laissez l'IA trouver les meilleures opportunités.</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">

            <div class="card border-0 shadow-lg rounded-4 overflow-hidden" id="mainCard">
                <div class="card-body p-5">

                    @if (ViewBag.Error != null)
                    {
                        <div class="alert alert-danger rounded-3 mb-4 text-start">
                            <i class="fas fa-exclamation-triangle me-2"></i> @ViewBag.Error
                        </div>
                    }

                    <form method="post" enctype="multipart/form-data" id="iaForm">

                        <div class="mb-4 text-start">
                            <label class="form-label fw-bold text-muted text-uppercase small">Votre CV (PDF)</label>

                            <div class="input-group">
                                <span class="input-group-text bg-light border-0"><i class="fas fa-file-pdf text-danger"></i></span>
                                <input type="file" name="cvFile" class="form-control form-control-lg bg-light border-0" accept=".pdf" required>
                            </div>
                            <div class="form-text small mt-2">
                                <i class="fas fa-info-circle me-1"></i> Fichiers PDF texte uniquement (pas de scans images).
                            </div>
                        </div>

                        <button type="submit" class="btn btn-lg w-100 rounded-pill fw-bold text-white shadow-sm hover-scale"
                                style="background: linear-gradient(135deg, #f6c23e 0%, #fd7e14 100%); border:none;">
                            <i class="fas fa-bolt me-2"></i> LANCER L'ANALYSE
                        </button>
                    </form>

                    <p class="small text-muted mt-3 mb-0">
                        Comparaison sémantique sur <strong>@ViewBag.OffresCount offres</strong> actives.
                    </p>
                </div>
            </div>

        </div>
    </div>

    <div id="loadingOverlay" class="d-none position-fixed top-0 start-0 w-100 h-100 d-flex flex-column align-items-center justify-content-center"
         style="background: rgba(255, 255, 255, 0.95); z-index: 9999; backdrop-filter: blur(5px);">

        <div class="mb-4 position-relative">
            <div class="spinner-border text-warning" role="status" style="width: 5rem; height: 5rem; border-width: 5px;"></div>
            <div class="position-absolute top-50 start-50 translate-middle text-warning">
                <i class="fas fa-brain fa-2x"></i>
            </div>
        </div>

        <h3 class="fw-bold text-dark mb-2">Analyse en cours...</h3>
        <p class="text-muted" id="loadingText">Lecture du fichier PDF</p>

        <div class="progress w-25 mt-3" style="height: 6px;">
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-warning" role="progressbar" style="width: 100%"></div>
        </div>
    </div>

</div>

<script>
    document.getElementById('iaForm').onsubmit = function() {

        const overlay = document.getElementById('loadingOverlay');
        overlay.classList.remove('d-none');


        const texts = [
            "Extraction du texte sémantique...",
            "Vectorisation TF-IDF...",
            "Comparaison avec les offres...",
            "Calcul des scores de pertinence...",
            "Finalisation..."
        ];

        let i = 0;
        const textElement = document.getElementById('loadingText');

        setInterval(() => {
            if (i < texts.length) {
                textElement.innerText = texts[i];

                textElement.style.opacity = 0.5;
                setTimeout(() => textElement.style.opacity = 1, 200);
                i++;
            }
        }, 1200);
    };
</script>

<style>

    .animate-fade-in {
        animation: fadeIn 0.8s ease-out;
    }
    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .hover-scale:hover {
        transform: scale(1.02);
        transition: transform 0.2s;
    }
</style>